<template>

    <!-- Loading overlay -->
    <template if:true={isLoading}>
        <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
    </template>

    <!--Placeholder Text-->
    <p class="slds-text-color_weak slds-m-vertical_small">{placeholder}</p>
    

    <lightning-card title="Resume Wizard" icon-name="standard:article" variant="narrow">
        <div class="slds-p-horizontal_medium slds-p-vertical_small"> 

            <!--Banner indicating whether user is in edit or create mode -->
            <template if:true={isEditMode}>
                <div class="slds-notify slds-notify_alert slds-theme_info slds-m-bottom_small" role="status">
                    <span class="slds-assistive-text">info</span>
                    <h2 class="slds-truncate">
                        Editing resume
                        <template if:true={resumeName}>â€” {resumeName}</template>
                        <template if:true={resumeId}>&nbsp;({resumeId})</template>
                    </h2>
                </div>
            </template>
            <template if:false={isEditMode}>
                <div class="slds-notify slds-notify_alert slds-theme_success slds-m-bottom_small" role="status">
                    <span class="slds-assistive-text">success</span>
                    <h2 class="slds-truncate">Creating a new resume</h2>
                </div>
            </template>            

            <!--This section shows a path component to guide the user through the process-->
            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-1 slds-p-around_medium">
                <lightning-progress-indicator 
                        current-step={currentStep} 
                        type="path"
                        variant="base"
                        has-error={hasStepError}
                        onchange={handleStepChange}
                        onclick={handleStepChange}
                        on>
                    <lightning-progress-step label="Basic Information" value="basic"></lightning-progress-step>
                    <lightning-progress-step label="Education" value="education"></lightning-progress-step>
                    <lightning-progress-step label="Work Experience" value="work"></lightning-progress-step>
                    <lightning-progress-step label="Skills" value="skills"></lightning-progress-step>
                    <lightning-progress-step label="Certifications" value="certs"></lightning-progress-step>
                    <lightning-progress-step label="Review & Finish" value="review"></lightning-progress-step>
                </lightning-progress-indicator>
            </div>
        </div>

        <!--render each step as a sub-lwc conditionally-->
        <div class="slds-p-horizontal_medium slds-p-bottom_large">

            <!--Display the Basic Info step-->
            <template if:true={isStepBasic}>
                <c-basicinfostep 
                    resume-id={resumeId}
                    onsubmit={handleFormSubmit}
                    onsuccess={handleFormSuccess}
                    onerror={handleFormError}>
                </c-basicinfostep>
            </template>

            <!--Display the Education step-->
            <template if:true={isStepEducation}>
                <c-educationstep 
                    resume-id={resumeId}
                    onsuccess={handleFormSuccess}
                    onerror={handleFormError}>
                </c-educationstep>
            </template>

            <!--Display the Work Experience step-->
            <template if:true={isStepWork}>
                <c-workexperiencestep 
                    resume-id={resumeId}
                    onsuccess={handleFormSuccess}
                    onerror={handleFormError}>
                </c-workexperiencestep>
            </template>

            <!--Display the Skills step-->
            <template if:true={isStepSkills}>
                <c-skillsstep 
                    resume-id={resumeId}
                    onsuccess={handleFormSuccess}
                    onerror={handleFormError}>
                </c-skillsstep>
            </template>

            <!--Display the Certifications step-->
            <template if:true={isStepCerts}>
                <c-certsstep 
                    resume-id={resumeId}
                    onsuccess={handleFormSuccess}
                    onerror={handleFormError}>
                </c-certsstep>
            </template>

            <!--Display the Review & Save step-->
            <template if:true={isStepReview}>
                <c-reviewandfinishstep 
                    resume-id={resumeId}
                    onsuccess={handleFormSuccess}
                    onerror={handleFormError}>
                </c-reviewandfinishstep>
            </template>
        </div>

        <!-- Footer Actions -->
        <div class="slds-p-around_medium slds-border_top">
            <div class="slds-grid slds-gutters slds-wrap slds-align_absolute-center">
                <lightning-button
                    class="slds-m-right_small"
                    variant="neutral"
                    label="Back"
                    title="Back"
                    onclick={handleBack}
                    disabled={isFirstStep}
                ></lightning-button>
                
                <template if:false={isLastStep}>
                    <lightning-button
                        class="slds-m-right_small"
                        variant="brand-outline"
                        label="Next"
                        title="Next"
                        onclick={handleNext}
                    ></lightning-button>
                
                    <lightning-button
                        variant="brand"
                        label="Save & Next"
                        title="Save and go to next step"
                        onclick={handleSaveAndNext}
                        disabled={isLastStep}
                    ></lightning-button>
                </template>

                <template if:true={isLastStep}>
                    <lightning-button
                        variant="brand"
                        label="Finish"
                        title="Finish"
                        onclick={handleFinish}
                    ></lightning-button>
                </template>                
            </div>
        </div>        

    </lightning-card>

    <!-- Toast messages surface -->
    <lightning-messages>
        <template if:true={toastMessage}>
            <div class="slds-notify slds-notify_toast slds-theme_{toastSeverity}
                slds-notify_alert slds-theme_{toastSeverity} slds-m-bottom_small" role="status">
                <span class="slds-assistive-text">{toastSeverity}</span>
                <h2 class="slds-truncate">{toastMessage}</h2>
            </div>
        </template>
    </lightning-messages>
        
</template>